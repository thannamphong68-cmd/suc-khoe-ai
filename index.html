<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthyAI Cinematic</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #020617; color: #f1f5f9; overflow-x: hidden; }
        
        /* Hiệu ứng hiện từ từ cho Modal */
        .reveal-item { opacity: 0; transform: translateY(20px); transition: all 0.8s ease-out; }
        .reveal-item.active { opacity: 1; transform: translateY(0); }

        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.08); border-radius: 2rem; }
        
        /* Animation cho các ô chỉ số */
        @keyframes pulse-blue { 0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(59, 130, 246, 0); } 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); } }
        .ai-active { animation: pulse-blue 2s infinite; }

        #result-modal { display: none; position: fixed; inset: 0; z-index: 100; background: rgba(0,0,0,0.95); align-items: center; justify-content: center; padding: 20px; overflow-y: auto; }
        
        .typewriter { overflow: hidden; border-right: .15em solid orange; white-space: nowrap; margin: 0 auto; letter-spacing: .15em; animation: typing 3.5s steps(40, end), blink-caret .75s step-end infinite; }
    </style>
</head>
<body>

    <audio id="snd-typing" src="https://assets.mixkit.co/active_storage/sfx/1110/1110-preview.mp3"></audio>

    <div id="intro-screen" class="fixed inset-0 z-[999] bg-[#020617] flex items-center justify-center">
        <div class="text-center">
            <h1 class="text-6xl font-black mb-4 tracking-tighter">Healthy<span class="text-blue-500">AI</span></h1>
            <p id="ca-dao" class="text-blue-200/40 italic mb-8"></p>
            <button onclick="startApp()" class="px-10 py-4 border border-blue-500 text-blue-500 rounded-full font-bold hover:bg-blue-500 hover:text-white transition-all">THÂM NHẬP HỆ THỐNG</button>
        </div>
    </div>

    <div class="p-4 lg:p-10 max-w-7xl mx-auto min-h-screen">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mt-10">
            <div class="lg:col-span-4 space-y-6">
                <div class="glass p-8 border-t-4 border-blue-500">
                    <h3 class="text-xs font-black uppercase text-blue-500 mb-6">Thông số sinh học</h3>
                    <div class="space-y-4">
                        <input type="text" id="uName" placeholder="Tên của bạn" class="w-full bg-white/5 p-4 rounded-xl border border-white/10 outline-none focus:border-blue-500">
                        <div class="grid grid-cols-2 gap-4">
                            <input type="number" id="uAge" placeholder="Tuổi" class="w-full bg-white/5 p-4 rounded-xl border border-white/10">
                            <input type="number" id="uWeight" placeholder="Cân nặng" class="w-full bg-white/5 p-4 rounded-xl border border-white/10">
                        </div>
                        <input type="number" id="uHeight" placeholder="Chiều cao (cm)" class="w-full bg-white/5 p-4 rounded-xl border border-white/10">
                        <button onclick="runAnalysis()" class="w-full py-5 bg-blue-600 rounded-2xl font-black tracking-widest ai-active">BẮT ĐẦU QUÉT <i class="fas fa-microchip ml-2"></i></button>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-8 glass p-8">
                <canvas id="mainChart" class="max-h-[400px]"></canvas>
            </div>
        </div>
    </div>

    <div id="result-modal">
        <div id="report" class="w-full max-w-4xl space-y-8 p-4">
            <div class="reveal-item text-center">
                <h2 id="resName" class="text-5xl font-black tracking-tighter text-white">--</h2>
                <p id="resBioAge" class="text-blue-400 font-bold mt-2 uppercase tracking-widest"></p>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="reveal-item glass p-6 text-center border-b-2 border-blue-500">
                    <p class="text-[10px] opacity-50 mb-1 uppercase">BMI Thực tế</p>
                    <h4 id="resBMI" class="text-3xl font-black">--</h4>
                </div>
                <div class="reveal-item glass p-6 text-center border-b-2 border-emerald-500">
                    <p class="text-[10px] opacity-50 mb-1 uppercase">Nước (L/Ngày)</p>
                    <h4 id="resWater" class="text-3xl font-black text-emerald-400">--</h4>
                </div>
                <div class="reveal-item glass p-6 text-center border-b-2 border-orange-500">
                    <p class="text-[10px] opacity-50 mb-1 uppercase">Mỡ cơ thể</p>
                    <h4 id="resFat" class="text-3xl font-black text-orange-400">--</h4>
                </div>
                <div class="reveal-item glass p-6 text-center border-b-2 border-purple-500">
                    <p class="text-[10px] opacity-50 mb-1 uppercase">Điểm Tế Bào</p>
                    <h4 id="resCell" class="text-3xl font-black text-purple-400">--</h4>
                </div>
            </div>

            <div class="reveal-item glass p-8 min-h-[150px] relative overflow-hidden">
                <div class="absolute top-0 left-0 w-1 h-full bg-blue-500"></div>
                <h5 class="text-blue-500 font-black text-xs uppercase mb-4">AI Insight:</h5>
                <p id="ai-text" class="text-lg italic text-blue-100 leading-relaxed"></p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="reveal-item glass p-6 bg-white/5">
                    <i class="fas fa-clock text-blue-500 mb-4"></i>
                    <h6 class="font-black text-xs uppercase mb-2">Giờ ngủ vàng</h6>
                    <p id="resSleep" class="text-sm opacity-70"></p>
                </div>
                <div class="reveal-item glass p-6 bg-white/5">
                    <i class="fas fa-utensils text-orange-500 mb-4"></i>
                    <h6 class="font-black text-xs uppercase mb-2">Món ăn chủ đạo</h6>
                    <p id="resFood" class="text-sm opacity-70"></p>
                </div>
                <div class="reveal-item glass p-6 bg-white/5">
                    <i class="fas fa-running text-emerald-500 mb-4"></i>
                    <h6 class="font-black text-xs uppercase mb-2">Bài tập mục tiêu</h6>
                    <p id="resEx" class="text-sm opacity-70"></p>
                </div>
            </div>

            <div class="reveal-item flex gap-4 pt-10">
                <button onclick="download()" class="flex-1 py-4 bg-white text-black rounded-full font-black uppercase text-xs">Lưu báo cáo</button>
                <button onclick="location.reload()" class="px-8 py-4 glass rounded-full font-black uppercase text-xs">Thoát</button>
            </div>
        </div>
    </div>

    <script>
        const caDaos = ["Sức khỏe là vàng.", "Có sức khỏe là có tất cả.", "Ăn được ngủ được là tiên."];
        let history = JSON.parse(localStorage.getItem('h_ai_v5') || '[]');

        window.onload = () => {
            document.getElementById('ca-dao').innerText = caDaos[Math.floor(Math.random() * caDaos.length)];
            initChart();
        };

        function startApp() {
            document.getElementById('intro-screen').style.opacity = '0';
            setTimeout(() => document.getElementById('intro-screen').style.display = 'none', 1000);
        }

        function typeWriter(text, elementId, speed = 30) {
            let i = 0;
            const element = document.getElementById(elementId);
            element.innerHTML = '';
            document.getElementById('snd-typing').play();
            
            function type() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                } else {
                    document.getElementById('snd-typing').pause();
                }
            }
            type();
        }

        function runAnalysis() {
            const h = parseFloat(document.getElementById('uHeight').value);
            const w = parseFloat(document.getElementById('uWeight').value);
            const age = parseInt(document.getElementById('uAge').value);
            const name = document.getElementById('uName').value || "Bản thể số";

            if (!h || !w || !age) return alert("Thiếu dữ liệu quét!");

            const bmi = (w / ((h/100)**2)).toFixed(1);
            const water = (w * 0.035).toFixed(1);
            const bioAge = age + (bmi > 25 ? 4 : -2);
            
            // Điền dữ liệu
            document.getElementById('resName').innerText = name;
            document.getElementById('resBMI').innerText = bmi;
            document.getElementById('resWater').innerText = water;
            document.getElementById('resFat').innerText = (bmi * 1.2).toFixed(1) + "%";
            document.getElementById('resCell').innerText = 100 - (Math.abs(bmi-22)*5);
            document.getElementById('resBioAge').innerText = `TUỔI SINH HỌC: ${bioAge}`;
            
            document.getElementById('resSleep').innerText = "Nên bắt đầu từ 22:15 để tối ưu gan.";
            document.getElementById('resFood').innerText = bmi > 25 ? "Salad ức gà, hạt điều, giảm cơm trắng." : "Sữa đậu nành, thịt bò, khoai tây hầm.";
            document.getElementById('resEx').innerText = bmi > 25 ? "HIIT 20 phút mỗi sáng." : "Push-up và nâng tạ nhẹ.";

            // Hiển thị Modal
            document.getElementById('result-modal').style.display = 'flex';

            // Hiệu ứng hiện từ từ (Staggered Reveal)
            const items = document.querySelectorAll('.reveal-item');
            items.forEach((item, index) => {
                setTimeout(() => {
                    item.classList.add('active');
                    if(item.querySelector('#ai-text')) {
                        typeWriter(`Hệ thống nhận diện mức BMI ${bmi}. Bạn đang trẻ hơn tuổi thật ${age - bioAge} tuổi. Hãy tập trung vào việc uống đủ ${water}L nước để duy trì trạng thái tế bào này...`, 'ai-text');
                    }
                }, index * 400);
            });
        }

        function initChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1', '2', '3', '4', '5'],
                    datasets: [{ label: 'BMI', data: [22, 23, 22.5, 24, 23.5], borderColor: '#3b82f6', tension: 0.4 }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        function download() {
            html2canvas(document.getElementById('report')).then(canvas => {
                const link = document.createElement('a');
                link.download = 'Health-Insight.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        }
    </script>
</body>
</html>
