<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aihealthy - OS Health v3.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap');
        :root { --brightness: 100%; }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: #020617; color: #f8fafc; 
            filter: brightness(var(--brightness));
            transition: filter 0.3s ease;
        }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); }
        .gradient-text { background: linear-gradient(135deg, #22d3ee, #818cf8, #f472b6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }

        /* Modal Blur */
        #intro-modal.active ~ #main-content { filter: blur(15px); pointer-events: none; }
    </style>
</head>
<body class="overflow-x-hidden">

    <div id="intro-modal" class="fixed inset-0 z-[100] flex items-center justify-center p-4 transition-all duration-500">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-md"></div>
        <div class="glass max-w-2xl w-full max-h-[80vh] rounded-[2.5rem] p-8 relative z-[101] overflow-y-auto shadow-2xl border-white/20">
            <h2 class="text-3xl font-black gradient-text mb-4 text-center">CHÀO MỪNG ĐẾN VỚI AIHEALTHY</h2>
            <div class="space-y-6 text-slate-300 text-sm leading-relaxed">
                <section>
                    <h3 class="font-bold text-white flex items-center gap-2"><i data-lucide="info"></i> Về Hệ Thống</h3>
                    <p>Aihealthy là trợ lý sinh trắc học thông minh, giúp bạn tính toán các chỉ số cơ thể dựa trên các thuật toán y khoa chuẩn quốc tế.</p>
                </section>
                <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="p-4 bg-white/5 rounded-2xl">
                        <h4 class="font-bold text-blue-400 mb-1">BMI (Chỉ số khối)</h4>
                        <p class="text-xs text-slate-400">Cách tính: $Weight / (Height^2)$. Đánh giá mức độ gầy/béo của cơ thể.</p>
                    </div>
                    <div class="p-4 bg-white/5 rounded-2xl">
                        <h4 class="font-bold text-purple-400 mb-1">BMR (Năng lượng nền)</h4>
                        <p class="text-xs text-slate-400">Sử dụng công thức Mifflin-St Jeor để tính lượng Calo tối thiểu bạn cần để duy trì sự sống.</p>
                    </div>
                </section>
                <section>
                    <h3 class="font-bold text-white">Cách sử dụng</h3>
                    <p>Nhập thông tin cá nhân bên trái, hệ thống sẽ tự động vẽ biểu đồ, đề xuất thực đơn và lịch tập riêng cho bạn.</p>
                </section>
            </div>
            <button onclick="closeIntro()" class="w-full mt-8 bg-white text-black font-black py-4 rounded-2xl hover:bg-blue-400 hover:text-white transition-all">BẮT ĐẦU NGAY</button>
        </div>
    </div>

    <main id="main-content" class="p-4 md:p-8 transition-all duration-500">
        <header class="max-w-7xl mx-auto flex justify-between items-center mb-8">
            <h1 class="text-3xl font-black tracking-tighter gradient-text">AIHEALTHY</h1>
            <div class="flex items-center gap-4 glass px-4 py-2 rounded-2xl">
                <i data-lucide="sun-medium" class="w-4 h-4 text-slate-400"></i>
                <input type="range" min="20" max="100" value="100" oninput="adjustBrightness(this.value)" class="w-20 accent-blue-500">
                <button onclick="showIntro()" class="text-xs font-bold text-blue-400 ml-2">HƯỚNG DẪN</button>
            </div>
        </header>

        <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
            <div class="lg:col-span-4 space-y-6">
                <div class="glass p-8 rounded-[3rem] border-t border-white/10 shadow-xl">
                    <h2 class="text-xl font-bold mb-6 flex items-center gap-2"><i data-lucide="user-plus"></i> Thông tin cá nhân</h2>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="col-span-2">
                                <label class="text-[10px] font-bold text-slate-500 ml-2 uppercase">Họ Tên</label>
                                <input type="text" id="username" placeholder="Ví dụ: Anh Tuấn" class="w-full bg-slate-900 border-none rounded-2xl p-4 mt-1 focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-500 ml-2 uppercase">Giới tính</label>
                                <select id="gender" class="w-full bg-slate-900 border-none rounded-2xl p-4 mt-1 outline-none">
                                    <option value="male">Nam</option>
                                    <option value="female">Nữ</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-500 ml-2 uppercase">Tuổi</label>
                                <input type="number" id="age" value="20" class="w-full bg-slate-900 border-none rounded-2xl p-4 mt-1 outline-none">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-[10px] font-bold text-slate-500 ml-2 uppercase">Cân nặng (kg)</label>
                                <input type="number" id="weight" value="60" class="w-full bg-slate-900 border-none rounded-2xl p-4 mt-1 outline-none">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-500 ml-2 uppercase">Chiều cao (cm)</label>
                                <input type="number" id="height" value="165" class="w-full bg-slate-900 border-none rounded-2xl p-4 mt-1 outline-none">
                            </div>
                        </div>
                        <button onclick="calculateAihealthy()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 py-5 rounded-2xl font-black shadow-lg shadow-blue-900/40 transition-all active:scale-95">PHÂN TÍCH DỮ LIỆU</button>
                    </div>
                </div>

                <div class="glass p-6 rounded-[2.5rem]">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold flex items-center gap-2"><i data-lucide="history"></i> Nhật ký đo</h3>
                        <button onclick="clearHistory()" class="text-[10px] text-red-400 font-bold uppercase hover:underline">Xóa hết</button>
                    </div>
                    <div id="history-list" class="space-y-3 max-h-[300px] overflow-y-auto pr-2">
                        <p class="text-xs text-slate-500 text-center py-4">Chưa có dữ liệu lịch sử</p>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="glass p-6 rounded-3xl bg-gradient-to-br from-blue-500/10 to-transparent">
                        <span class="text-xs text-slate-400 font-bold block mb-2 uppercase">Cân nặng lý tưởng</span>
                        <div id="res-ideal" class="text-3xl font-black text-blue-400">--</div>
                        <p class="text-[10px] text-slate-500 mt-2">Dựa trên công thức Lorentz</p>
                    </div>
                    <div class="glass p-6 rounded-3xl bg-gradient-to-br from-pink-500/10 to-transparent">
                        <span class="text-xs text-slate-400 font-bold block mb-2 uppercase">Body Fat (%)</span>
                        <div id="res-fat" class="text-3xl font-black text-pink-400">--</div>
                        <p class="text-[10px] text-slate-500 mt-2">Ước tính theo chỉ số BMI</p>
                    </div>
                    <div class="glass p-6 rounded-3xl bg-gradient-to-br from-emerald-500/10 to-transparent">
                        <span class="text-xs text-slate-400 font-bold block mb-2 uppercase">Sức khỏe tim mạch</span>
                        <div id="res-heart" class="text-3xl font-black text-emerald-400">--</div>
                        <p class="text-[10px] text-slate-500 mt-2">Mức độ ổn định dự kiến</p>
                    </div>
                </div>

                <div class="glass p-8 rounded-[3rem]">
                    <h3 class="font-bold mb-6 flex items-center gap-2"><i data-lucide="bar-chart-3"></i> Biểu đồ xu hướng</h3>
                    <div class="h-[300px]"><canvas id="mainChart"></canvas></div>
                </div>

                <div id="ai-suggestion" class="hidden glass p-8 rounded-[3rem] border-l-8 border-indigo-500 animate-in slide-in-from-bottom-5">
                    <div class="flex items-start gap-4">
                        <div class="p-4 bg-indigo-500 rounded-2xl"><i data-lucide="sparkles" class="text-white"></i></div>
                        <div>
                            <h3 id="ai-title" class="text-xl font-black mb-2">Chờ phân tích...</h3>
                            <p id="ai-desc" class="text-slate-400 text-sm leading-relaxed mb-4"></p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                                <div class="bg-white/5 p-4 rounded-2xl">
                                    <h4 class="text-xs font-bold text-blue-400 uppercase mb-2">Chế độ ăn</h4>
                                    <ul id="diet-box" class="text-xs space-y-2 text-slate-300"></ul>
                                </div>
                                <div class="bg-white/5 p-4 rounded-2xl">
                                    <h4 class="text-xs font-bold text-orange-400 uppercase mb-2">Vận động</h4>
                                    <ul id="move-box" class="text-xs space-y-2 text-slate-300"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        lucide.createIcons();

        // UI Logic
        function closeIntro() { document.getElementById('intro-modal').classList.add('opacity-0', 'invisible'); }
        function showIntro() { document.getElementById('intro-modal').classList.remove('opacity-0', 'invisible'); }
        function adjustBrightness(val) { document.documentElement.style.setProperty('--brightness', val + '%'); }

        // Data Management
        let history = JSON.parse(localStorage.getItem('aihealthy_log')) || [];
        let mainChart;

        function initChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            mainChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: history.map(h => h.date),
                    datasets: [{
                        label: 'Chỉ số BMI',
                        data: history.map(h => h.bmi),
                        borderColor: '#6366f1',
                        borderWidth: 4,
                        pointRadius: 6,
                        tension: 0.4,
                        fill: true,
                        backgroundColor: 'rgba(99, 102, 241, 0.1)'
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { 
                        y: { display: false }, 
                        x: { ticks: { color: '#64748b', font: { size: 10 } }, grid: { display: false } }
                    }
                }
            });
            renderHistory();
        }

        function calculateAihealthy() {
            const name = document.getElementById('username').value || "Người dùng";
            const gender = document.getElementById('gender').value;
            const age = parseInt(document.getElementById('age').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);

            if(!weight || !height) return alert("Vui lòng nhập chiều cao và cân nặng!");

            const bmi = (weight / ((height/100)**2)).toFixed(1);
            
            // Cân nặng lý tưởng (Lorentz)
            let ideal = (gender === 'male') ? (height - 100) - ((height - 150) / 4) : (height - 100) - ((height - 150) / 2);
            
            // Body Fat % (Deurenberg)
            const bf = (1.20 * bmi) + (0.23 * age) - (10.8 * (gender === 'male' ? 1 : 0)) - 5.4;

            // Cập nhật UI
            document.getElementById('res-ideal').innerText = ideal.toFixed(1) + "kg";
            document.getElementById('res-fat').innerText = Math.abs(bf).toFixed(1) + "%";
            document.getElementById('res-heart').innerText = bmi > 25 ? "Trung bình" : "Tốt";

            document.getElementById('ai-suggestion').classList.remove('hidden');
            document.getElementById('ai-title').innerText = `Phân tích cho ${name}`;
            
            let diet = [], move = [], desc = "";
            if(bmi < 18.5) {
                desc = "Bạn đang ở trạng thái thiếu cân. Cơ thể cần thêm năng lượng để nuôi dưỡng các hệ cơ quan.";
                diet = ["Tăng 500kcal/ngày từ ngũ cốc", "Bổ sung sinh tố bơ, hạt điều", "Ăn thêm bữa phụ trước khi ngủ"];
                move = ["Tập kháng lực (Gym) để tăng cơ", "Hạn chế Cardio kéo dài", "Ngủ đủ 8 tiếng"];
            } else if(bmi < 25) {
                desc = "Chúc mừng! Các chỉ số của bạn vô cùng lý tưởng. Hãy duy trì lối sống này.";
                diet = ["Giữ vững tỷ lệ 40-30-30 (Carb-Pro-Fat)", "Uống nước theo công thức: Cân nặng x 0.035"];
                move = ["Chạy bộ 30p mỗi sáng", "Tập Yoga để dẻo dai cột sống"];
            } else {
                desc = "Cảnh báo thừa cân. Bạn nên điều chỉnh để tránh các bệnh về chuyển hóa.";
                diet = ["Áp dụng nhịn ăn gián đoạn 16:8", "Cắt giảm 80% đường tinh luyện", "Ăn rau xanh trước mỗi bữa ăn"];
                move = ["Tập HIIT đốt mỡ 3 buổi/tuần", "Đi bộ nhanh ít nhất 10k bước"];
            }

            document.getElementById('ai-desc').innerText = desc;
            document.getElementById('diet-box').innerHTML = diet.map(i => `<li>• ${i}</li>`).join('');
            document.getElementById('move-box').innerHTML = move.map(i => `<li>• ${i}</li>`).join('');

            // Lưu lịch sử
            const date = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            history.push({ name, bmi, date, weight });
            if(history.length > 10) history.shift();
            localStorage.setItem('aihealthy_log', JSON.stringify(history));
            
            updateChart();
            renderHistory();
        }

        function renderHistory() {
            const list = document.getElementById('history-list');
            if(history.length === 0) {
                list.innerHTML = `<p class="text-xs text-slate-500 text-center py-4">Chưa có dữ liệu</p>`;
                return;
            }
            list.innerHTML = history.slice().reverse().map(h => `
                <div class="p-3 bg-white/5 rounded-xl flex justify-between items-center border border-white/5 hover:border-blue-500/30 transition-all">
                    <div>
                        <p class="text-[10px] font-bold text-slate-500 uppercase">${h.date} - ${h.name}</p>
                        <p class="text-sm font-bold">BMI: <span class="text-blue-400">${h.bmi}</span></p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs font-bold text-slate-300">${h.weight}kg</p>
                    </div>
                </div>
            `).join('');
        }

        function updateChart() {
            mainChart.data.labels = history.map(h => h.date);
            mainChart.data.datasets[0].data = history.map(h => h.bmi);
            mainChart.update();
        }

        function clearHistory() {
            if(confirm("Bạn có chắc chắn muốn xóa toàn bộ dữ liệu lịch sử không?")) {
                localStorage.removeItem('aihealthy_log');
                history = [];
                location.reload();
            }
        }

        window.onload = initChart;
    </script>
</body>
</html>
