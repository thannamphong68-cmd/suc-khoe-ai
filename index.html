<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Healthyai - Hệ Thống Sức Khỏe Thông Minh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap');
        :root { --primary: #3b82f6; --bg: #020617; --card: rgba(15, 23, 42, 0.8); --text: #f8fafc; }
        .light-mode { --primary: #2563eb; --bg: #f8fafc; --card: rgba(255, 255, 255, 0.9); --text: #0f172a; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); transition: all 0.4s ease; overflow-x: hidden; }
        .glass { background: var(--card); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.1); }
        .ai-glow { filter: drop-shadow(0 0 15px var(--primary)); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.7; transform: scale(1.05); } }
        #intro-screen { position: fixed; inset: 0; background: #020617; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.8s ease-in-out; }
        .loader-ring { width: 100px; height: 100px; border: 3px solid transparent; border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        #ai-chat-modal { display: none; }
        #ai-chat-modal.active { display: flex; animation: zoomIn 0.3s ease forwards; }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(59, 130, 246, 0.5); border-radius: 10px; }
    </style>
</head>
<body class="dark-mode">

    <div id="intro-screen">
        <div class="relative"><div class="loader-ring"></div><i data-lucide="sparkles" class="absolute inset-0 m-auto w-8 h-8 text-blue-500 ai-glow"></i></div>
        <h2 class="mt-8 text-xs font-black tracking-[0.5em] text-blue-400 uppercase">Healthyai xin chào...</h2>
        <p id="intro-quote" class="mt-4 text-slate-400 italic text-sm text-center px-10"></p>
        <div class="mt-6 w-48 h-1 bg-slate-800 rounded-full overflow-hidden"><div id="progress-bar" class="h-full bg-blue-500 w-0 transition-all duration-100"></div></div>
    </div>

    <nav class="max-w-7xl mx-auto flex justify-between items-center p-6 md:p-8">
        <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center shadow-2xl shadow-blue-500/40"><i data-lucide="heart-pulse" class="text-white w-7 h-7"></i></div>
            <h1 class="text-2xl font-black tracking-tighter">HEALTHYAI</h1>
        </div>
        <div class="flex items-center gap-4">
            <button onclick="askAI()" class="flex bg-blue-500/10 hover:bg-blue-500/20 text-blue-400 px-5 py-2.5 rounded-2xl text-xs font-black border border-blue-500/20 items-center gap-2 transition-all">
                <i data-lucide="message-circle" class="w-4 h-4"></i> CHAT VỚI AI
            </button>
            <button onclick="toggleTheme()" class="p-3 bg-white/5 rounded-2xl border border-white/5 hover:bg-white/10 transition"><i data-lucide="sun" id="theme-icon"></i></button>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto p-4 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <div class="lg:col-span-4 space-y-8">
            <div class="glass p-10 rounded-[3.5rem] text-center relative overflow-hidden group">
                <div class="absolute inset-0 bg-gradient-to-b from-blue-500/10 to-transparent"></div>
                <div class="relative z-10">
                    <p id="ca-dao-top" class="text-xs italic text-blue-400 mb-4"></p>
                    <div class="w-24 h-24 bg-blue-500/10 rounded-full flex items-center justify-center mx-auto mb-6 border border-blue-500/20 ai-glow">
                        <i data-lucide="user-check" class="w-10 h-10 text-blue-500"></i>
                    </div>
                    <h3 class="font-black text-xl uppercase tracking-tighter">Hồ sơ sức khỏe</h3>
                </div>
            </div>

            <div class="glass p-8 rounded-[3.5rem] space-y-6">
                <div class="space-y-4">
                    <div class="relative">
                        <input type="text" id="name" placeholder="Bạn tên gì?" class="w-full bg-black/20 border-none rounded-2xl p-5 text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <select id="gender" class="bg-black/20 border-none rounded-2xl p-5 text-sm outline-none"><option value="male">Nam</option><option value="female">Nữ</option></select>
                        <input type="number" id="age" placeholder="Tuổi của bạn" class="bg-black/20 border-none rounded-2xl p-5 text-sm outline-none">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="number" id="weight" placeholder="Cân nặng (kg)" class="bg-black/20 border-none rounded-2xl p-5 text-sm outline-none">
                        <input type="number" id="height" placeholder="Chiều cao (cm)" class="bg-black/20 border-none rounded-2xl p-5 text-sm outline-none">
                    </div>
                </div>
                <button onclick="processData()" class="w-full bg-blue-600 hover:bg-blue-500 py-5 rounded-2xl font-black text-xs uppercase tracking-widest shadow-xl shadow-blue-500/20 transition-all active:scale-95">Chạy phân tích AI</button>
            </div>
        </div>

        <div id="report-area" class="lg:col-span-8 space-y-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="glass p-6 rounded-3xl border-b-4 border-blue-500">
                    <span class="text-[10px] font-bold opacity-50 uppercase">Chỉ số BMI</span>
                    <div id="res-bmi" class="text-3xl font-black mt-2">--</div>
                </div>
                <div class="glass p-6 rounded-3xl border-b-4 border-purple-500">
                    <span class="text-[10px] font-bold opacity-50 uppercase">Cân nặng lý tưởng</span>
                    <div id="res-ideal" class="text-3xl font-black mt-2">--</div>
                </div>
                <div class="glass p-6 rounded-3xl border-b-4 border-pink-500">
                    <span class="text-[10px] font-bold opacity-50 uppercase">Tỷ lệ mỡ (%)</span>
                    <div id="res-fat" class="text-3xl font-black mt-2">--</div>
                </div>
                <div class="glass p-6 rounded-3xl border-b-4 border-emerald-500">
                    <span class="text-[10px] font-bold opacity-50 uppercase">Nước/Ngày</span>
                    <div id="res-water" class="text-3xl font-black mt-2">--</div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="glass p-8 rounded-[3rem] h-80">
                    <h4 class="text-xs font-bold opacity-50 uppercase mb-4">Biểu đồ sinh học</h4>
                    <div class="h-56"><canvas id="radarChart"></canvas></div>
                </div>
                <div class="glass p-8 rounded-[3rem] h-80">
                    <h4 class="text-xs font-bold opacity-50 uppercase mb-4">Theo dõi BMI qua thời gian</h4>
                    <div class="h-56"><canvas id="lineChart"></canvas></div>
                </div>
            </div>

            <div class="glass p-6 rounded-[2.5rem]">
                <h4 class="text-xs font-bold opacity-50 uppercase mb-4 ml-2 italic" id="ca-dao-bottom"></h4>
                <div id="history-box" class="flex gap-4 overflow-x-auto pb-2 custom-scrollbar"></div>
            </div>
        </div>
    </main>

    <div id="ai-chat-modal" class="fixed inset-0 z-[100] items-center justify-center p-4 bg-black/90 backdrop-blur-xl">
        <div class="glass max-w-2xl w-full rounded-[3.5rem] overflow-hidden flex flex-col shadow-2xl border-white/10">
            <div class="p-8 border-b border-white/5 flex justify-between items-center bg-blue-600/10">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center ai-glow"><i data-lucide="bot" class="text-white"></i></div>
                    <div>
                        <h3 class="font-black text-lg">TRỢ LÝ HEALTHYAI</h3>
                        <p class="text-[10px] text-blue-400 font-bold uppercase tracking-widest">Tư vấn sức khỏe & dậy thì</p>
                    </div>
                </div>
                <button onclick="closeAI()" class="p-3 hover:bg-white/10 rounded-full transition"><i data-lucide="x"></i></button>
            </div>
            
            <div id="ai-chat-content" class="p-8 space-y-8 max-h-[65vh] overflow-y-auto custom-scrollbar">
                <div class="p-6 bg-white/5 rounded-3xl italic text-slate-400 text-sm">Vui lòng nhập thông tin để AI phân tích...</div>
            </div>

            <div class="p-8 flex gap-4">
                <button onclick="downloadReport()" class="flex-1 bg-white/5 hover:bg-white/10 py-4 rounded-2xl text-xs font-bold transition">TẢI BÁO CÁO</button>
                <button onclick="closeAI()" class="flex-1 bg-blue-600 hover:bg-blue-500 py-4 rounded-2xl text-xs font-bold transition uppercase">Hoàn tất</button>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        
        const caDaos = [
            "Muốn cho thân thể bình yên - Ăn uống điều độ, ngủ yên đúng giờ.",
            "Có sức khỏe là có tất cả - Không sức khỏe là không có gì.",
            "Ăn được ngủ được là tiên - Không ăn không ngủ mất tiền thêm lo.",
            "Sức khỏe là vàng, ai ơi hãy nhớ - Chớ có lơ là, hối hận khôn nguôi.",
            "Luyện thân cho khỏe cho bền - Để mà gánh vác việc nền nước non."
        ];

        let logs = JSON.parse(localStorage.getItem('healthy_logs')) || [];
        let radar, line;

        // Intro Logic
        document.getElementById('intro-quote').innerText = caDaos[Math.floor(Math.random() * caDaos.length)];
        let prg = 0;
        const prgBar = document.getElementById('progress-bar');
        const intr = setInterval(() => {
            prg += Math.random() * 25;
            prgBar.style.width = Math.min(prg, 100) + '%';
            if(prg >= 100) {
                clearInterval(intr);
                setTimeout(() => {
                    document.getElementById('intro-screen').style.transform = 'translateY(-100%)';
                    document.getElementById('ca-dao-top').innerText = caDaos[Math.floor(Math.random() * caDaos.length)];
                    document.getElementById('ca-dao-bottom').innerText = "Lời dạy: " + caDaos[Math.floor(Math.random() * caDaos.length)];
                }, 500);
            }
        }, 200);

        function initCharts() {
            const rCtx = document.getElementById('radarChart').getContext('2d');
            radar = new Chart(rCtx, {
                type: 'radar',
                data: {
                    labels: ['BMI', 'Nước', 'Lý tưởng', 'Mỡ', 'Tuổi'],
                    datasets: [{ data: [0,0,0,0,0], borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.2)', pointRadius: 4 }]
                },
                options: { 
                    scales: { r: { grid: { color: 'rgba(255,255,255,0.05)' }, angleLines: { color: 'rgba(255,255,255,0.05)' }, ticks: { display: false } } },
                    plugins: { legend: { display: false } }
                }
            });

            const lCtx = document.getElementById('lineChart').getContext('2d');
            line = new Chart(lCtx, {
                type: 'line',
                data: { labels: logs.map(l=>l.t), datasets: [{ data: logs.map(l=>l.b), borderColor: '#818cf8', tension: 0.4, fill: true, backgroundColor: 'rgba(129, 140, 248, 0.1)' }] },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    scales: { 
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, title: { display: true, text: 'Chỉ số BMI', color: '#475569', font: { size: 10 } } },
                        x: { grid: { display: false }, title: { display: true, text: 'Thời gian đo', color: '#475569', font: { size: 10 } } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
            renderHistory();
        }

        function processData() {
            const w = parseFloat(document.getElementById('weight').value);
            const h = parseFloat(document.getElementById('height').value);
            const name = document.getElementById('name').value || "Người dùng";
            const age = parseInt(document.getElementById('age').value) || 0;
            const g = document.getElementById('gender').value;

            if(!w || !h || !age) return alert("Vui lòng nhập đầy đủ Tên, Tuổi, Chiều cao và Cân nặng!");

            const bmi = (w / ((h/100)**2)).toFixed(1);
            const water = (w * 0.035).toFixed(1);
            const ideal = (g === 'male') ? (h - 100) - ((h - 150) / 4) : (h - 100) - ((h - 150) / 2);
            const bf = Math.abs((1.2 * bmi) + (0.23 * age) - (10.8 * (g==='male'?1:0)) - 5.4).toFixed(1);

            document.getElementById('res-bmi').innerText = bmi;
            document.getElementById('res-ideal').innerText = ideal.toFixed(1) + "kg";
            document.getElementById('res-fat').innerText = bf + "%";
            document.getElementById('res-water').innerText = water + "L";

            radar.data.datasets[0].data = [bmi, water * 5, ideal / 2, bf, age];
            radar.update();

            const t = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            logs.push({t, b: bmi, n: name});
            if(logs.length > 8) logs.shift();
            localStorage.setItem('healthy_logs', JSON.stringify(logs));
            
            line.data.labels = logs.map(l=>l.t);
            line.data.datasets[0].data = logs.map(l=>l.b);
            line.update();
            renderHistory();
            
            setTimeout(askAI, 600);
        }

        function askAI() {
            const modal = document.getElementById('ai-chat-modal');
            const content = document.getElementById('ai-chat-content');
            const bmi = document.getElementById('res-bmi').innerText;
            const age = parseInt(document.getElementById('age').value);
            const name = document.getElementById('name').value || "bạn";
            
            modal.classList.add('active');
            if(bmi === "--") return;

            content.innerHTML = `<div class="flex items-center gap-3"><div class="loader-ring w-6 h-6"></div> <span class="text-sm">Healthyai đang tính toán...</span></div>`;

            setTimeout(() => {
                let pubertyAnalysis = "";
                let foodSuggest = "Rau xanh, cá hồi, các loại hạt và hoa quả tươi.";
                let sleepTime = "22:00 - 06:00";

                // Phân tích dậy thì & bệnh lý
                if(age >= 9 && age <= 13) {
                    pubertyAnalysis = "<b>Giai đoạn chớm dậy thì:</b> Cần chú ý các bệnh về cột sống (cong vẹo), cận thị học đường và tâm lý thay đổi thất thường.";
                    foodSuggest = "Ưu tiên canxi từ sữa, tôm, cua và Vitamin D để tăng chiều cao.";
                } else if(age > 13 && age <= 18) {
                    pubertyAnalysis = "<b>Giai đoạn dậy thì chính thức:</b> Nguy cơ mụn trứng cá nặng, rối loạn nội tiết, và các bệnh tâm lý như stress thi cử. Nam giới cần chú ý sự phát triển cơ bắp, nữ giới cần bổ sung sắt.";
                    foodSuggest = "Bổ sung kẽm, sắt (thịt bò, gan) và hạn chế đồ ăn nhanh, dầu mỡ.";
                    sleepTime = "Tối thiểu 8 tiếng. Nên ngủ trước 22:30.";
                } else {
                    pubertyAnalysis = "<b>Giai đoạn trưởng thành:</b> Cần chú ý các bệnh về lối sống như đau vai gáy, dạ dày do ăn uống không điều độ.";
                }

                const b = parseFloat(bmi);
                let bmiAdvice = b < 18.5 ? "Bạn hơi gầy, cần tăng cường đạm." : (b < 25 ? "Cơ thể rất cân đối!" : "Bạn đang thừa cân, hãy tập Cardio thêm nhé.");

                content.innerHTML = `
                    <div class="space-y-6">
                        <div class="p-6 bg-blue-600/10 border border-blue-500/20 rounded-[2rem] text-sm">
                            <h4 class="font-bold text-blue-400 mb-2 uppercase italic">Chào ${name}, AI phân tích:</h4>
                            <p>${pubertyAnalysis}</p>
                            <p class="mt-2"><b>Lời khuyên BMI:</b> ${bmiAdvice}</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="p-5 bg-emerald-500/5 border border-emerald-500/20 rounded-3xl">
                                <h5 class="text-[10px] font-black text-emerald-400 uppercase mb-2">Gợi ý món ăn</h5>
                                <p class="text-xs text-slate-300">${foodSuggest}</p>
                            </div>
                            <div class="p-5 bg-orange-500/5 border border-orange-500/20 rounded-3xl">
                                <h5 class="text-[10px] font-black text-orange-400 uppercase mb-2">Giờ ngủ & Nghỉ ngơi</h5>
                                <p class="text-xs text-slate-300">Khung giờ vàng: <b>${sleepTime}</b>. Tránh ánh sáng xanh trước khi ngủ 30p.</p>
                            </div>
                        </div>
                    </div>
                `;
            }, 1200);
        }

        function renderHistory() {
            const box = document.getElementById('history-box');
            box.innerHTML = logs.slice().reverse().map(l => `
                <div class="flex-shrink-0 p-4 bg-white/5 rounded-2xl border border-white/5 min-w-[130px]">
                    <p class="text-[9px] font-bold opacity-40 uppercase">${l.t}</p>
                    <p class="text-xs font-bold text-blue-400">${l.n}</p>
                    <p class="text-white font-black mt-1">BMI: ${l.b}</p>
                </div>
            `).join('');
        }

        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const isL = document.body.classList.contains('light-mode');
            document.getElementById('theme-icon').setAttribute('data-lucide', isL ? 'moon' : 'sun');
            lucide.createIcons();
        }

        function closeAI() { document.getElementById('ai-chat-modal').classList.remove('active'); }
        
        function downloadReport() {
            html2canvas(document.getElementById('report-area'), { backgroundColor: '#020617' }).then(canvas => {
                const a = document.createElement('a');
                a.download = 'Healthyai-Bao-Cao.png';
                a.href = canvas.toDataURL();
                a.click();
            });
        }

        window.onload = initCharts;
    </script>
</body>
</html>
