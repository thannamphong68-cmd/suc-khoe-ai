<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthyAI Universe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;600;700&display=swap');
        
        :root {
            --neon-blue: #00f2ff;
            --neon-green: #39ff14;
            --neon-purple: #bc13fe;
            --deep-bg: #050505;
        }

        body { 
            font-family: 'Space Grotesk', sans-serif; 
            background-color: var(--deep-bg); 
            color: #e2e8f0;
            overflow-x: hidden;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 24px;
            transition: 0.4s;
        }

        .glass-card:hover {
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.1);
        }

        .text-neon { color: var(--neon-blue); text-shadow: 0 0 10px rgba(0, 242, 255, 0.5); }
        
        /* Hiệu ứng gõ chữ AI */
        .cursor { display: inline-block; width: 10px; background-color: var(--neon-blue); animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        /* Scrollbar tinh tế */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: var(--deep-bg); }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

        #result-modal { 
            display: none; position: fixed; inset: 0; z-index: 1000; 
            background: rgba(0,0,0,0.98); padding: 20px; overflow-y: auto;
        }
        
        .reveal { opacity: 0; transform: translateY(30px); transition: 1s ease; }
        .reveal.show { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body>

    <div id="intro-screen" class="fixed inset-0 z-[9999] bg-black flex items-center justify-center">
        <div class="text-center">
            <div class="text-6xl mb-6 animate-pulse text-neon"><i class="fas fa-microchip"></i></div>
            <h1 class="text-5xl font-bold tracking-tighter mb-2">HEALTHY<span class="text-neon">AI</span></h1>
            <p id="ca-dao" class="text-gray-500 italic mb-8"></p>
            <button onclick="enterSystem()" class="px-12 py-4 border border-cyan-500 text-cyan-400 rounded-full hover:bg-cyan-500 hover:text-black transition duration-500 font-bold tracking-widest">KÍCH HOẠT HỆ THỐNG</button>
        </div>
    </div>

    <div class="p-4 lg:p-8 max-w-[1400px] mx-auto">
        <nav class="flex justify-between items-center mb-12">
            <div class="text-2xl font-bold tracking-tighter">UNIVERSE <span class="text-neon">v6</span></div>
            <button onclick="clearData()" class="text-[10px] text-gray-500 hover:text-red-400">XÓA DỮ LIỆU GỐC</button>
        </nav>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-4 space-y-6">
                <div class="glass-card p-8">
                    <h3 class="text-xs font-bold text-gray-500 uppercase mb-8 tracking-[0.3em]">Quét Sinh Trắc Học</h3>
                    <div class="space-y-5">
                        <div class="relative">
                            <input type="text" id="uName" class="w-full bg-white/5 p-4 rounded-xl outline-none focus:ring-1 ring-cyan-500 border border-white/5 text-cyan-50" placeholder="Tên đối tượng">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <input type="number" id="uAge" class="w-full bg-white/5 p-4 rounded-xl outline-none border border-white/5" placeholder="Tuổi">
                            <select id="uGender" class="bg-white/5 p-4 rounded-xl border border-white/5 outline-none focus:ring-1 ring-cyan-500">
                                <option class="bg-black">Nam</option>
                                <option class="bg-black">Nữ</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <input type="number" id="uHeight" class="w-full bg-white/5 p-4 rounded-xl outline-none border border-white/5" placeholder="Cao (cm)">
                            <input type="number" id="uWeight" class="w-full bg-white/5 p-4 rounded-xl outline-none border border-white/5" placeholder="Nặng (kg)">
                        </div>
                        <button onclick="runAnalysis()" class="w-full py-5 bg-cyan-600 text-black font-bold rounded-2xl shadow-[0_0_30px_rgba(0,242,255,0.3)] hover:brightness-125 transition">BẮT ĐẦU PHÂN TÍCH</button>
                    </div>
                </div>
                
                <div class="glass-card p-6">
                    <h4 class="text-[10px] text-gray-500 uppercase mb-4">Lịch sử quét</h4>
                    <canvas id="miniChart" height="150"></canvas>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-6">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="glass-card p-6 border-b-2 border-cyan-500">
                        <span class="text-[10px] text-gray-500 uppercase">BMI</span>
                        <div id="curBMI" class="text-3xl font-bold mt-2">--</div>
                    </div>
                    <div class="glass-card p-6 border-b-2 border-green-500">
                        <span class="text-[10px] text-gray-500 uppercase">Nước / Lít</span>
                        <div id="curWater" class="text-3xl font-bold mt-2 text-green-400">--</div>
                    </div>
                    <div class="glass-card p-6 border-b-2 border-purple-500">
                        <span class="text-[10px] text-gray-500 uppercase">Rank</span>
                        <div id="curRank" class="text-3xl font-bold mt-2 text-purple-400">--</div>
                    </div>
                    <div class="glass-card p-6 border-b-2 border-orange-500">
                        <span class="text-[10px] text-gray-500 uppercase">Mỡ %</span>
                        <div id="curFat" class="text-3xl font-bold mt-2 text-orange-400">--</div>
                    </div>
                </div>
                
                <div class="glass-card p-8 min-h-[450px]">
                    <h3 class="text-xs font-bold text-gray-500 uppercase mb-6">Tiến trình sinh học</h3>
                    <canvas id="mainChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div id="result-modal">
        <div class="max-w-6xl mx-auto space-y-8">
            <div class="reveal flex flex-col md:flex-row justify-between items-end gap-6 border-b border-white/10 pb-10">
                <div>
                    <span id="rankText" class="text-cyan-500 font-bold tracking-widest text-xs uppercase">--</span>
                    <h2 id="resName" class="text-6xl font-bold text-white tracking-tighter mt-2">--</h2>
                    <p id="resStatus" class="text-gray-400 mt-2 italic"></p>
                </div>
                <div class="text-right">
                    <div id="bioAge" class="text-4xl font-bold text-neon">--</div>
                    <div class="text-xs text-gray-500 uppercase tracking-widest">Tuổi Sinh Học</div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="reveal glass-card p-8 flex flex-col items-center justify-center">
                    <canvas id="radarChart"></canvas>
                    <p class="text-[10px] text-gray-500 mt-6 uppercase">Biểu đồ Radar Sức Mạnh</p>
                </div>
                
                <div class="reveal lg:col-span-2 space-y-6">
                    <div class="glass-card p-8 min-h-[200px] border-l-4 border-cyan-500">
                        <h4 class="text-cyan-500 font-bold text-xs uppercase mb-4">AI Nhận Xét & Lời Khuyên:</h4>
                        <div class="text-xl text-gray-200 leading-relaxed italic">
                            <span id="aiComment"></span><span class="cursor"></span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="glass-card p-6 bg-cyan-500/5">
                            <div class="text-cyan-500 mb-2"><i class="fas fa-utensils"></i></div>
                            <h5 class="text-xs font-bold uppercase mb-2">Thực Đơn</h5>
                            <p id="resFood" class="text-xs text-gray-400"></p>
                        </div>
                        <div class="glass-card p-6 bg-purple-500/5">
                            <div class="text-purple-500 mb-2"><i class="fas fa-dumbbell"></i></div>
                            <h5 class="text-xs font-bold uppercase mb-2">Bài Tập</h5>
                            <p id="resEx" class="text-xs text-gray-400"></p>
                        </div>
                        <div class="glass-card p-6 bg-orange-500/5">
                            <div class="text-orange-500 mb-2"><i class="fas fa-bed"></i></div>
                            <h5 class="text-xs font-bold uppercase mb-2">Giấc Ngủ</h5>
                            <p id="resSleep" class="text-xs text-gray-400"></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="reveal flex gap-4">
                <button onclick="download()" class="flex-grow py-5 bg-white text-black font-bold rounded-2xl uppercase text-xs tracking-widest">Xuất Dữ Liệu PNG</button>
                <button onclick="closeModal()" class="px-12 py-5 glass-card font-bold uppercase text-xs">Đóng</button>
            </div>
        </div>
    </div>

    <script>
        const caDaos = [
            "Cơm là bản, cá là vương, sức khỏe là kim cương.",
            "Ăn được ngủ được là tiên, không ăn không ngủ mất tiền thêm lo.",
            "Muốn cho mình được mạnh lành, ăn uống tiết độ giữ gìn sạch trong."
        ];
        let history = JSON.parse(localStorage.getItem('h_ai_v6') || '[]');
        let mainChart, miniChart, radarChart;

        window.onload = () => {
            document.getElementById('ca-dao').innerText = caDaos[Math.floor(Math.random() * caDaos.length)];
            initAllCharts();
            updateDashboard();
        };

        function enterSystem() {
            document.getElementById('intro-screen').style.opacity = '0';
            setTimeout(() => document.getElementById('intro-screen').style.display = 'none', 1000);
        }

        function initAllCharts() {
            // Main Line Chart
            const ctxMain = document.getElementById('mainChart').getContext('2d');
            mainChart = new Chart(ctxMain, {
                type: 'line',
                data: {
                    labels: history.map((_, i) => i + 1).slice(-10),
                    datasets: [{
                        label: 'BMI',
                        data: history.map(h => h.bmi).slice(-10),
                        borderColor: '#00f2ff',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        backgroundColor: 'rgba(0, 242, 255, 0.05)'
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });

            // Mini History Chart
            const ctxMini = document.getElementById('miniChart').getContext('2d');
            miniChart = new Chart(ctxMini, {
                type: 'bar',
                data: {
                    labels: history.map((_, i) => i + 1).slice(-5),
                    datasets: [{ data: history.map(h => h.bmi).slice(-5), backgroundColor: '#bc13fe' }]
                },
                options: { plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
            });
        }

        function runAnalysis() {
            const h = parseFloat(document.getElementById('uHeight').value);
            const w = parseFloat(document.getElementById('uWeight').value);
            const age = parseInt(document.getElementById('uAge').value);
            const gender = document.getElementById('uGender').value;
            const name = document.getElementById('uName').value || "Chủ thể Alpha";

            if (!h || !w || !age) return alert("Hệ thống yêu cầu nạp đủ dữ liệu!");

            const bmi = (w / ((h/100)**2)).toFixed(1);
            const water = (w * 0.035).toFixed(1);
            const fat = (bmi * 1.2 + 0.23 * age - (gender === "Nam" ? 16.2 : 5.4)).toFixed(1);
            
            let rank = 'B';
            if (bmi >= 18.5 && bmi <= 24) rank = 'S';
            else if (bmi > 24 && bmi < 28) rank = 'A';
            else if (bmi >= 28) rank = 'C';
            else rank = 'D';

            // Update UI
            document.getElementById('resName').innerText = name;
            document.getElementById('curBMI').innerText = bmi;
            document.getElementById('curWater').innerText = water;
            document.getElementById('curRank').innerText = rank;
            document.getElementById('curFat').innerText = fat + "%";
            document.getElementById('rankText').innerText = `PHÂN HẠNG CƠ THỂ: ${rank}-RANK`;
            document.getElementById('bioAge').innerText = age + (rank === 'S' ? -3 : 2);
            document.getElementById('resStatus').innerText = bmi > 25 ? "Hệ thống phát hiện mỡ thừa vượt mức." : "Chỉ số sinh học đang ở mức ổn định.";
            
            // Gợi ý AI
            document.getElementById('resFood').innerText = "Ưu tiên protein sạch, cắt giảm tinh bột nhanh.";
            document.getElementById('resEx').innerText = "Tập kháng lực (Weightlifting) để tăng mật độ xương.";
            document.getElementById('resSleep').innerText = "Tắt thiết bị điện tử từ 22h, ngủ trước 23h.";

            // Hiển thị Modal
            document.getElementById('result-modal').style.display = 'block';
            
            // Hiệu ứng Reveal
            setTimeout(() => {
                document.querySelectorAll('.reveal').forEach((el, i) => {
                    setTimeout(() => el.classList.add('show'), i * 300);
                });
                typeEffect(`Dựa trên dữ liệu quét, cơ thể bạn đang ở Rank ${rank}. Chỉ số BMI ${bmi} cho thấy bạn cần tập trung vào việc ${bmi > 25 ? 'đốt mỡ thừa' : 'tăng khối lượng cơ'}. Hãy duy trì lượng nước ${water}L mỗi ngày để tối ưu hóa bộ máy sinh học.`);
            }, 100);

            // Radar Chart
            initRadar(bmi, fat, water);

            // Save
            history.push({ name, bmi: parseFloat(bmi), water, date: new Date().toLocaleDateString() });
            localStorage.setItem('h_ai_v6', JSON.stringify(history));
            initAllCharts();
        }

        function typeEffect(text) {
            let i = 0;
            const el = document.getElementById('aiComment');
            el.innerText = '';
            function type() {
                if (i < text.length) {
                    el.innerText += text.charAt(i);
                    i++;
                    setTimeout(type, 25);
                }
            }
            type();
        }

        function initRadar(bmi, fat, water) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            if(radarChart) radarChart.destroy();
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['BMI', 'Mỡ', 'Nước', 'Sức bền', 'Dinh dưỡng'],
                    datasets: [{
                        data: [bmi * 2, 100-fat, water * 10, 70, 80],
                        borderColor: '#00f2ff',
                        backgroundColor: 'rgba(0, 242, 255, 0.2)'
                    }]
                },
                options: {
                    scales: { r: { grid: { color: '#333' }, angleLines: { color: '#333' }, pointLabels: { color: '#888' }, ticks: { display: false } } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function closeModal() {
            document.getElementById('result-modal').style.display = 'none';
            document.querySelectorAll('.reveal').forEach(el => el.classList.remove('show'));
        }

        function updateDashboard() {
            if(history.length > 0) {
                const l = history[history.length - 1];
                document.getElementById('curBMI').innerText = l.bmi;
                document.getElementById('curWater').innerText = l.water;
            }
        }

        function clearData() { if(confirm("Hành động này sẽ xóa toàn bộ dữ liệu quét?")) { localStorage.clear(); location.reload(); } }
        
        function download() {
            html2canvas(document.getElementById('report')).then(canvas => {
                const a = document.createElement('a');
                a.download = 'HEALTHYAI-REPORT.png';
                a.href = canvas.toDataURL();
                a.click();
            });
        }
    </script>
</body>
</html>
