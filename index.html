<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthyAI Prime - Smart Future</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        :root { --p: #3b82f6; --bg: #020617; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f8fafc; color: #1e293b; transition: 0.5s; overflow-x: hidden; }
        .dark-mode { background: #020617; color: #f1f5f9; }
        .glass { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.2); border-radius: 2.5rem; }
        .dark-mode .glass { background: rgba(15, 23, 42, 0.7); border-color: rgba(255,255,255,0.05); }
        
        #intro-screen { position: fixed; inset: 0; z-index: 999; background: #020617; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #result-modal { display: none; position: fixed; inset: 0; z-index: 100; background: rgba(0,0,0,0.85); backdrop-filter: blur(20px); align-items: center; justify-content: center; padding: 15px; overflow-y: auto; }
        
        .ai-emoji { font-size: 4rem; filter: drop-shadow(0 0 15px rgba(59,130,246,0.5)); animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        
        .score-bar-fill { transition: width 1.5s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .glitch { animation: glitch 1s linear infinite; }
        @keyframes glitch { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }
    </style>
</head>
<body class="dark-mode">

    <audio id="snd-click" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>
    <audio id="snd-success" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>
    <audio id="snd-fail" src="https://assets.mixkit.co/active_storage/sfx/253/253-preview.mp3"></audio>

    <div id="intro-screen">
        <div class="text-center">
            <div class="mb-6 inline-block p-6 rounded-full bg-blue-600/20 text-blue-500 text-6xl shadow-[0_0_50px_rgba(59,130,246,0.3)]">
                <i class="fas fa-atom animate-spin-slow"></i>
            </div>
            <h1 class="text-white text-5xl font-black tracking-tighter mb-4">Healthy<span class="text-blue-500">AI</span> Prime</h1>
            <p id="ca-dao" class="text-blue-200/60 italic mb-10 max-w-md mx-auto"></p>
            <button onclick="initApp()" class="px-12 py-5 bg-blue-600 text-white rounded-full font-black tracking-widest hover:scale-110 transition-all shadow-2xl">TRUY C·∫¨P H·ªÜ TH·ªêNG</button>
        </div>
    </div>

    <div class="min-h-screen p-4 lg:p-10">
        <nav class="max-w-7xl mx-auto flex justify-between items-center mb-10">
            <div class="text-2xl font-black text-blue-500">H-AI.</div>
            <div class="flex gap-4">
                <button onclick="toggleTheme()" class="w-12 h-12 glass flex items-center justify-center"><i id="tIcon" class="fas fa-sun"></i></button>
                <button onclick="resetData()" class="px-6 glass text-[10px] font-black text-red-400">RESET</button>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
            <div class="lg:col-span-4 space-y-6">
                <div class="glass p-8 bg-blue-900/10 border-blue-500/20">
                    <h3 class="text-xs font-black uppercase text-blue-400 mb-6 tracking-widest">D·ªØ li·ªáu sinh tr·∫Øc h·ªçc</h3>
                    <div class="space-y-4">
                        <input type="text" id="uName" placeholder="T√™n b·∫°n l√† g√¨?" class="w-full bg-white/5 p-4 rounded-2xl outline-none border border-white/10 focus:border-blue-500">
                        <div class="grid grid-cols-2 gap-4">
                            <input type="number" id="uAge" placeholder="Tu·ªïi" class="w-full bg-white/5 p-4 rounded-2xl outline-none border border-white/10">
                            <select id="uGender" class="w-full bg-white/5 p-4 rounded-2xl outline-none border border-white/10"><option>Nam</option><option>N·ªØ</option></select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <input type="number" id="uHeight" placeholder="Cao (cm)" class="w-full bg-white/5 p-4 rounded-2xl outline-none border border-white/10">
                            <input type="number" id="uWeight" placeholder="N·∫∑ng (kg)" class="w-full bg-white/5 p-4 rounded-2xl outline-none border border-white/10">
                        </div>
                        <button onclick="process()" class="w-full py-5 bg-blue-600 text-white rounded-3xl font-black uppercase tracking-widest hover:brightness-125 transition shadow-xl shadow-blue-500/30">QU√âT CH·ªà S·ªê <i class="fas fa-bolt ml-2"></i></button>
                    </div>
                </div>

                <div class="glass p-6">
                    <p class="text-[10px] font-black opacity-40 uppercase mb-2">L·∫ßn g·∫ßn nh·∫•t</p>
                    <div id="last-info" class="text-sm italic opacity-80">ƒêang ch·ªù d·ªØ li·ªáu...</div>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-6">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="glass p-6 text-center"><p class="text-[10px] font-bold opacity-40 uppercase">BMI</p><h4 id="dBMI" class="text-2xl font-black">--</h4></div>
                    <div class="glass p-6 text-center"><p class="text-[10px] font-bold opacity-40 uppercase">Score</p><h4 id="dScore" class="text-2xl font-black text-emerald-400">--</h4></div>
                    <div class="glass p-6 text-center"><p class="text-[10px] font-bold opacity-40 uppercase">M·ª° %</p><h4 id="dFat" class="text-2xl font-black text-orange-400">--</h4></div>
                    <div class="glass p-6 text-center"><p class="text-[10px] font-bold opacity-40 uppercase">C∆° %</p><h4 id="dMuscle" class="text-2xl font-black text-indigo-400">--</h4></div>
                </div>
                <div class="glass p-8 h-[450px]">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div id="result-modal">
        <div id="report" class="glass bg-slate-900 w-full max-w-5xl p-8 md:p-12 shadow-[0_0_100px_rgba(0,0,0,0.5)] overflow-hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
                <div class="text-center space-y-6 border-r border-white/5 pr-6">
                    <div id="aiEmoji" class="ai-emoji">ü§ñ</div>
                    <div class="space-y-1">
                        <h2 id="resName" class="text-3xl font-black tracking-tighter">--</h2>
                        <p id="resBioAge" class="text-blue-400 font-bold text-xs uppercase"></p>
                    </div>
                    <div class="p-4 bg-white/5 rounded-3xl">
                        <p class="text-[10px] font-bold opacity-40 mb-2">D·ª∞ ƒêO√ÅN 30 NG√ÄY</p>
                        <p id="resPredict" class="text-emerald-400 font-black"></p>
                    </div>
                </div>

                <div class="lg:col-span-2 space-y-8">
                    <div class="flex justify-between items-end">
                        <div>
                            <span class="text-[10px] font-black text-blue-400 uppercase">Health Score</span>
                            <h3 id="resScore" class="text-6xl font-black">0</h3>
                        </div>
                        <div class="text-right">
                            <span id="resBody" class="px-4 py-1 bg-blue-600 rounded-full text-[10px] font-black uppercase tracking-widest">--</span>
                        </div>
                    </div>

                    <div class="w-full bg-white/5 h-4 rounded-full overflow-hidden">
                        <div id="scoreBar" class="score-bar-fill h-full bg-gradient-to-r from-blue-600 to-emerald-500" style="width: 0%"></div>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="p-4 bg-white/5 rounded-2xl border border-white/5">
                            <p class="text-[9px] font-bold opacity-40">BMI</p>
                            <p id="resBMI" class="font-black text-xl">--</p>
                        </div>
                        <div class="p-4 bg-white/5 rounded-2xl border border-white/5">
                            <p class="text-[9px] font-bold opacity-40">CALO</p>
                            <p id="resCalo" class="font-black text-xl">--</p>
                        </div>
                        <div class="p-4 bg-white/5 rounded-2xl border border-white/5">
                            <p class="text-[9px] font-bold opacity-40">M·ª† %</p>
                            <p id="resFat" class="font-black text-xl">--</p>
                        </div>
                        <div class="p-4 bg-white/5 rounded-2xl border border-white/5">
                            <p class="text-[9px] font-bold opacity-40">C∆† %</p>
                            <p id="resMuscle" class="font-black text-xl">--</p>
                        </div>
                    </div>

                    <div class="p-6 bg-blue-600/10 rounded-3xl border border-blue-500/20">
                        <h4 class="text-[10px] font-black text-blue-400 uppercase mb-2">AI T∆∞ v·∫•n ƒë·∫∑c bi·ªát</h4>
                        <p id="resAdvice" class="text-sm italic opacity-90 leading-relaxed"></p>
                    </div>
                </div>
            </div>

            <div class="mt-10 flex gap-4">
                <button onclick="download()" class="flex-1 py-5 bg-white text-black rounded-3xl font-black uppercase tracking-widest hover:bg-blue-500 hover:text-white transition-all"><i class="fas fa-camera mr-2"></i> Xu·∫•t B√°o C√°o</button>
                <button onclick="closeModal()" class="px-10 py-5 glass rounded-3xl font-black uppercase text-xs">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <script>
        const caDaos = [
            "S·ª©c kh·ªèe l√† v√†ng, c√≥ s·ª©c kh·ªèe l√† c√≥ t·∫•t c·∫£.",
            "ƒÇn ƒë∆∞·ª£c ng·ªß ƒë∆∞·ª£c l√† ti√™n, kh√¥ng ƒÉn kh√¥ng ng·ªß m·∫•t ti·ªÅn th√™m lo.",
            "Ng∆∞·ªùi c√≥ s·ª©c kh·ªèe c√≥ 100 ∆∞·ªõc mu·ªën, ng∆∞·ªùi kh√¥ng c√≥ s·ª©c kh·ªèe ch·ªâ c√≥ 1 ∆∞·ªõc mu·ªën duy nh·∫•t.",
            "Ph√≤ng b·ªánh h∆°n ch·ªØa b·ªánh, h√£y y√™u b·∫£n th√¢n m√¨nh ngay h√¥m nay."
        ];
        let history = JSON.parse(localStorage.getItem('h_ai_prime') || '[]');
        let chart;

        function playSound(id) { document.getElementById(id).currentTime = 0; document.getElementById(id).play(); }

        function initApp() {
            playSound('snd-click');
            document.getElementById('intro-screen').style.transform = 'scale(1.5)';
            document.getElementById('intro-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('intro-screen').style.display = 'none';
                initChart();
                updateDash();
            }, 800);
        }

        window.onload = () => {
            document.getElementById('ca-dao').innerText = caDaos[Math.floor(Math.random() * caDaos.length)];
        };

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('tIcon').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            initChart();
        }

        function initChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            const isDark = document.body.classList.contains('dark-mode');
            if(chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: history.map((_, i) => `L·∫ßn ${i+1}`).slice(-7),
                    datasets: [{
                        label: 'BMI',
                        data: history.map(h => h.bmi).slice(-7),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true, tension: 0.4, borderWidth: 5
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });
        }

        function process() {
            playSound('snd-click');
            const h = parseFloat(document.getElementById('uHeight').value), w = parseFloat(document.getElementById('uWeight').value);
            const age = parseInt(document.getElementById('uAge').value), gender = document.getElementById('uGender').value;
            const name = document.getElementById('uName').value || "Ng∆∞·ªùi b·∫°n";

            if(!h || !w || !age) return alert("H·ªá th·ªëng c·∫ßn th√™m d·ªØ li·ªáu!");

            // Logic t√≠nh to√°n
            const bmi = (w / ((h/100)**2)).toFixed(1);
            const fat = (bmi * 1.2 + 0.23 * age - (gender === "Nam" ? 16.2 : 5.4)).toFixed(1);
            const water = ((gender === "Nam" ? 60 : 55) - (bmi * 0.4)).toFixed(1);
            const muscle = (100 - fat - water).toFixed(1);
            const tdee = Math.round(((10 * w) + (6.25 * h) - (5 * age) + (gender === "Nam" ? 5 : -161)) * 1.3);

            let score = Math.round(100 - Math.abs(bmi - 22) * 6);
            score = Math.min(Math.max(score, 15), 100);

            // Bio Age & Prediction
            const bioAge = age + (bmi > 25 ? 3 : bmi < 18 ? 2 : -2);
            const predict = bmi > 25 ? `Gi·∫£m ~2.4kg m·ª°` : `TƒÉng ~1.5kg c∆°`;

            // Emoji & Sound Logic
            let emoji = "ü§©";
            if(score > 85) { emoji = "üî•"; playSound('snd-success'); }
            else if(score > 65) { emoji = "üí™"; playSound('snd-success'); }
            else if(score > 45) { emoji = "üòê"; playSound('snd-fail'); }
            else { emoji = "üö®"; playSound('snd-fail'); }

            // UI Update
            document.getElementById('resName').innerText = name;
            document.getElementById('resScore').innerText = score;
            document.getElementById('resBMI').innerText = bmi;
            document.getElementById('resCalo').innerText = tdee;
            document.getElementById('resFat').innerText = fat + "%";
            document.getElementById('resMuscle').innerText = muscle + "%";
            document.getElementById('resBioAge').innerText = `Tu·ªïi sinh h·ªçc: ${bioAge} tu·ªïi`;
            document.getElementById('resPredict').innerText = predict;
            document.getElementById('aiEmoji').innerText = emoji;
            document.getElementById('scoreBar').style.width = score + "%";
            
            let status = bmi < 18.5 ? "G·∫ßy" : bmi < 25 ? "C√¢n ƒë·ªëi" : "Th·ª´a c√¢n";
            document.getElementById('resBody').innerText = status;
            document.getElementById('resAdvice').innerText = `AI nh·∫≠n th·∫•y b·∫°n ƒëang ·ªü m·ª©c ${status}. V·ªõi ch·ªâ s·ªë c∆° b·∫Øp ${muscle}%, b·∫°n n√™n ${bmi > 25 ? '∆∞u ti√™n th√¢m h·ª•t calo' : 'tƒÉng c∆∞·ªùng Protein'}. M·ª•c ti√™u ƒëi·ªÉm c·ªßa b·∫°n l√† 90+!`;

            // Save
            history.push({ bmi: parseFloat(bmi), score, fat, muscle, date: new Date().toLocaleDateString() });
            localStorage.setItem('h_ai_prime', JSON.stringify(history));

            document.getElementById('result-modal').style.display = 'flex';
            updateDash();
            initChart();
        }

        function updateDash() {
            if(history.length > 0) {
                const l = history[history.length - 1];
                document.getElementById('dBMI').innerText = l.bmi;
                document.getElementById('dScore').innerText = l.score;
                document.getElementById('dFat').innerText = l.fat + "%";
                document.getElementById('dMuscle').innerText = l.muscle + "%";
                document.getElementById('last-info').innerText = `L·∫ßn ƒëo g·∫ßn nh·∫•t (${l.date}): ${l.score} ƒëi·ªÉm.`;
            }
        }

        function closeModal() { document.getElementById('result-modal').style.display = 'none'; }
        function resetData() { if(confirm("X√≥a l·ªãch s·ª≠?")) { localStorage.clear(); location.reload(); } }
        function download() {
            html2canvas(document.getElementById('report')).then(canvas => {
                const link = document.createElement('a');
                link.download = 'HealthyAI-Prime-Report.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        }
    </script>
</body>
</html>
